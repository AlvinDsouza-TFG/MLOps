parameters:
  rm_service_connection: ''
  base_name: ''
  AKS_CLUSTER: ''

jobs:
      - job: CreateAKSCluster
        steps:
          - task: AzureCLI@1
            displayName: 'Install the CLI'
            inputs:
              azureSubscription:  ${{ parameters.rm_service_connection }}
              scriptLocation: inlineScript
              inlineScript: 'az extension add -n azure-cli-ml'

          - task: AzureCLI@1
            displayName: 'Provision AKS Cluster'
            inputs:
              azureSubscription:  ${{ parameters.rm_service_connection }}
              scriptLocation: inlineScript
              inlineScript: 'az ml computetarget create aks --name ${{ parameters.AKS_CLUSTER }} --resource-group ${{ parameters.base_name }}-aml-rg --workspace-name ${{ parameters.base_name }}-aml-ws --cluster-purpose FastProd'